# Defect-Formation-Calculation

This package is a integrated Defect Formation energy package, which contains generating tetrahedral interstitial sites and  octahedral interstitial sites, submitting `VASP` calculation job and withdraw necessary data to calculate defect formation energy.


Table of Contents
=================

   * [Defect-Formation-Calculation](#defect-formation-calculation)
      * [0. Installment](#0-installment)
      * [1. Generate defect structures](#1-generate-defect-structures)
      * [2. submit your common calculatiojobn jobs](#2-submit-your-common-calculatiojobn-jobs)
         * [2.1 potcar.sh](#21-potcarsh)
         * [2.2 incar.sh](#22-incarsh)
         * [2.3 kpoints.sh](#23-kpointssh)
         * [2.4 some test-parameters scripts](#24-some-test-parameters-scripts)
         * [2.5 some integrated scripts](#25-some-integrated-scripts)
      * [3. Get some calculation value in your vaspout files](#3-get-some-calculation-value-in-your-vaspout-files)
         * [3.1 vaspout-help](#31-vaspout-help)
         * [3.2 vaspout-main](#32-vaspout-main)
         * [3.2 vaspout-get_delete_atom_num](#32-vaspout-get_delete_atom_num)
         * [3.3 vaspout-get_farther_atom_num](#33-vaspout-get_farther_atom_num)
         * [3.3 vaspout-get_potential_align](#33-vaspout-get_potential_align)




## 0. Installment
Firstly, you should make a directory for those scripts and add its path to your `.bashrc`. I divide these scripts into three directories so that you can easily know the usage of each scripts, and you can put them all into a directory in order to conveniently use them. For example, I make the `scripts` directory under my $HOME directory, so I can use the below command to add this directory to $PATH, and `source` your `.bashrc` to make it work.

```shell
echo export PATH="$PATH:/home/hecc/scripts" >> ~/.bashrc
source ~/.bashrc
```

## 1. Generate defect structures

There are three kinds of defect system you can generate, vacancy defect, purity defect and interstitial defect. All these can be generated by [defect_maker](./defect_maker.py), and the generated structures in VASP format will be stored in a directory named by its attributes.



## 2. submit your common calculatiojobn jobs

First, we supply some shell scripts to generate those input file for VASP calculation, they are [potcar.sh](./common_calculation_shell/potcar.sh), [incar.sh](./common_calculation_shell/incar.sh), [kpoints.sh](./common_calculation_shell/kpoints.sh). Below I will simply introduce the usage of these scripts.

__These scripts will not work if correspondent files exist, for example, incar.sh will not work if an INCAR file exists in your current directory__

### 2.1 potcar.sh
There are two parameters you can input. The first parameter is the type of potcar

* 1 is correspondent to `PAW_PBE`
* 2 is correspondent to `PAW_LDA`
* 3 is correspondent to `PAW_PW91`
* 4 is correspondent to `USPP_LDA`
* 5 is correspondent to `USPP_PW91`

the defaul of first parameter is 1, and if it can uncompress `POTCAR.Z` file to `POTCAR`.

The second parameter is the type of atom potcar, maybe the same atom has some different type of potcar, for example, Mg atom has `Mg, Mg_GW, Mg_pv, Mg_pv_GW, Mg_sv, Mg_sv_GW` potcar, so you can specify one of them to get specify POTCAR, the defaul of this parameter is the atom itself.
```shell
potcar.sh 2 # this will generate the POTCAR based on your PSOCAR from  PAW_LDA directory
potcar.sh 1 Mg_pv # noted that 1 can be omited
```

### 2.2 incar.sh
This script is used to generate INCAR for your system, and it supposes that the POTCAR has been in your directory, because `ENCUT` should be set based on the `ENMAX` of your POTCAR.

### 2.3 kpoints.sh
This script is used to generate KPOINTS, the usage is:
```shell
kpoint.sh 40 # this will generate KPOINTS mesh 40/a 40/b 40/c
kpoint.sh band # this will genrate k-path based on `aflow`
```

### 2.4 some test-parameters scripts

[kp_test.sh](./parameter_test_shell/kp_test.sh) can test what kinds of KPOINTS you should use, and [encut_test.sh](./parameter_test_shell/encut_test.sh) can help you test what `ENCUT` is best suitable for your calculations.


### 2.5 some integrated scripts

Here, we supply some integrated shell scripts to calculate the jobs you need.<br />
- [x] [stru_relax.sh](./common_calculation_shell/stru_relax.sh) (structure relax, ISIF=3)<br />
- [x] [stru_optimization.sh](./common_calculation_shell/stru_optimization.sh) (structure optimization, ISIF=2)<br />
- [x] [struscf.sh](./common_calculation_shell/stru_scf.sh) (structure self consistent field calculation)<br />
- [x] [stru_band.sh](./common_calculation_shell/stru_band.sh) (band calculation)<br />
- [x] [stru_dos.sh](./common_calculation_shell/stru_dos.sh) (density of state calculation)<br />
- [x] [job.sh](./common_calculation_shell/job.sh) (submit your job)

We also supply some scripts to generate the input files needed in `VASP` Calculation, such as `INCAR`, `KPOINTS`, `POTCAR`, you can also use these  scripts to generate them. So in general, you can just begin your job from a `POSCAR` and a `job.sh`.

## 3. Get some calculation value in your vaspout files

Here we supply a command interface to get the value you want.

### 3.1 vaspout-help
```shell
module load sagar #load the necesary package
vaspout.py --help # you can get some short help from this command
vaspout.py main --help # get the help of a specific command  
```

### 3.2 vaspout-`main`
This command is used to get some common value of your calculation system. For instance, gap, fermi energy, electrons number and so on.
The last parameter is the directory path of your calculation system, make sure it is right or you will get wrong answer.
```shell
vaspout.py main -a gap . # this can read the gap and vbm, cbm
vaspout.py main -a fermi . # this can read the fermi energy
vaspout.py main -a energy . # this can read the total energy
vaspout.py main -a ele . # this can read the electrons in your OUTCAR
vaspout.py main -a ele-free . # this can get electrons number of  the defect-free system
vaspout.py main -a image image_corr/ # this can get Ewald energy of your system
```


### 3.3 vaspout-`get_PA`
This command can get the electrostatic of your defect system and no defect system of the farther atom from defect atom
```shell
vaspout.py get_PA defect_free charge_state_1
```
